<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>微信收款码</title>
    <link rel="stylesheet" href="css/font-awesome.min.css"/>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/toast.css">
    <link rel="stylesheet" type="text/css" href="css/radio-checkbox.css"/>
    <link rel="stylesheet" href="css/css.css">
    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/base64.js"></script>
    <script src="js/API.js"></script>
    <!---->
    <script src="js/toast.js"></script>
    <style>
        .h_name {
            width: 60px;
            border: none;
            border-bottom: 1px solid;
            outline: 0;
            white-space: nowrap;overflow: hidden;text-overflow: ellipsis
        }
        .h_nameTwo{
            display: inline-block;width: 40px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;
        }
        .h_status{
            display: inline-block;width: 44px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;
        }
        label.bui-switch-label .bui-switch{
            width: 40px;
            height: 20px;
        }
        label.bui-switch-label .bui-switch:before{
            width: 19px;
            height: 18px;
        }
        .h_opt{
            display: inline-block;width: 34px;text-align: center;
        }
        .glyphicon-check{
            color:#088cfc;
        }
        .glyphicon-remove{
            color:#eb9707;
        }
        table>tbody>tr:last-of-type{
            border-bottom: 1px solid #ddd;
        }
    </style>
</head>
<body>
<div class="page">
    <header>
        <div class="back">
            <i class="fa fa-angle-left"></i>
        </div>
        <p>二维码列表</p>
        <span></span>
    </header>
    <div class="empty"></div>
    <div class="shoukuan">
        <!-- <div class="up">
            <i class="fa fa-qrcode"></i>
        </div> -->
        <!-- <div class="link">
            <div class="list">
                <div class="item"><i class="fa fa-book"></i>教程攻略</div>
                <div class="item"><i class="fa fa-lock"></i>安全密码</div>
            </div>
        </div> -->
        <div class="down">
            <div class="con">
                <div class="tab">
                    <div class="item" onclick="window.location.href='wechar_collectioncode.html'">上传二维码</div>
                    <div class="item active" onclick="window.location.href='wechar_collectioncode_list.html'">二维码列表
                    </div>
                </div>
                <br>
                <div class="content">

                    <!--<div class="upload active" id="tableList">-->
                    <!--<div class="container">-->

                    <!--</div>-->
                    <table class="table" id="datas">
                        <tr>
                            <th width="20%">微信名</th>
                            <th width="17%">备注</th>
                            <th width="20%">审核状态</th>
                            <th width="20%">开启状态</th>
                            <th width="20%">操作</th>
                        </tr>
                        <tr>
                            <td><input class="h_name" type="text" size="8" value="11111"></td>
                            <td title="actName1"><span class="h_nameTwo">actName1</span></td>
                            <td title="通过" class="h_status">通过</td>
                            <td>
                                <label class="bui-switch-label bui-switch-anim">
                                <input type="checkbox" name="s" checked /><i class="bui-switch"></i>

                            </td>
                            <td>
                                <span class="h_opt">
                                <i class="glyphicon glyphicon-check"></i>
                                <i class="glyphicon glyphicon-remove"></i>
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td><input class="h_name" type="text" size="8"></td>
                            <td><span class="h_nameTwo">actName1</span></td>
                            <td class="h_status">通过</td>
                            <td>
                                <label class="bui-switch-label bui-switch-anim">
                                    <input type="checkbox" name="s" checked /><i class="bui-switch"></i>
                                </label>
                            </td>
                            <td>
                                <span class="h_opt">
                                <i class="glyphicon glyphicon-check"></i>
                                <i class="glyphicon glyphicon-remove"></i>
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td><input class="h_name" type="text" size="8"></td>
                            <td title="actName1"><span class="h_nameTwo">actName1</span></td>
                            <td title="待审核" class="h_status">待审核</td>
                            <td>
                                <label class="bui-switch-label bui-switch-anim">
                                    <input type="checkbox" name="s" checked /><i class="bui-switch"></i>
                                </label>
                            </td>
                            <td>
                                <span class="h_opt">
                                <i class="glyphicon glyphicon-check"></i>
                                <i class="glyphicon glyphicon-remove"></i>
                                </span>
                            </td>
                        </tr>
                    </table>
                </div>
                <div>

                </div>
            </div>
        </div>
        <!--<div class="jieshi">-->
        <!--<p>* 1.收款码请务必添加一张不设置金额的通用二维码，通用二维码支持个人码,商用码，聚合码</p>-->
        <!--<p>* 2.同一微信收款码切勿重复上传，若造成金额损失，平台概不负责</p>-->
        <!--<p>* 3.为提高成功率，连续收款失败四次及以上，系统将自动删除对应二维码，请及时检查</p>-->
        <!--</div>-->
    </div>
</div>
<!--<div class="container">-->
<!--<div class="row clearfix">-->
<!--<div class="col-xs-3 col-sm-3 column">-->
<!--<div>微信名</div>-->
<!--<div><input type="text" class="h_name" id="name"></div>-->
<!--</div>-->
<!--<div class="col-xs-2 col-sm-3 column">-->
<!--<div>备注</div>-->
<!--<div>ggggg</div>-->
<!--</div>-->
<!--<div class="col-xs-3 col-sm-3 column">-->
<!--<div>审核状态</div>-->
<!--<div>ggggg</div>-->
<!--</div>-->
<!--<div class="col-xs-2 col-sm-3 column">-->
<!--<div>状态</div>-->
<!--<div>ggggg</div>-->
<!--</div>-->
<!--<div class="col-xs-2 col-sm-3 column">-->
<!--<div>操作</div>-->
<!--<div>ggggg</div>-->
<!--</div>-->
<!--</div>-->
</div>
</div>
</body>
<script type="text/javascript">
  $(function () {
    $(".back").on('click', function () {
//            history.back(-1);
      window.location.href = 'homepage.html';
    });
    loadList();
  })


  function loadList() {
    if (null == storage.getItem("yf_token") || storage.getItem("yf_token") == "") {
      window.location.href = 'login.html';
    }
    let timestamp = Date.parse(new Date());
//        let base64 = `{"token": "${storage.getItem("yf_token")}","pageNumber": 1,"pageSize": 20,"agtVer":${publicMap.get("agtVer")},"clientVer":${publicMap.get("clientVer")},"clientType":${publicMap.get("clientType")},"ctime": ${timestamp}}`;
    let base64 = `{"token": "111111","pageNumber": 1,"pageSize": 20,"agtVer":${publicMap.get("agtVer")},"clientVer":${publicMap.get("clientVer")},"clientType":${publicMap.get("clientType")},"ctime": ${timestamp}}`;
    let base = new Base64();
    let result = base.encode(base64);
    let jsonData = JSON.stringify({"jsonData": result});
    $.ajax({
      url: API + '/fine/collAc/getDataList',
      type: 'post',
      dataType: 'json',
      contentType: "application/json",
      data: jsonData,
      // 成功执行
      success(data) {
        let code = data.resultCode;
        if (code !== "0") {
          showMessage(data.message);
        } else {
          let base64 = data.data.jsonData;
          let base = new Base64();
          let rsData = base.decode(base64);
          let rsDataJson = JSON.parse(rsData);

          Callback(rsDataJson.dataList);
//                        showMessage('保存成功!');
        }
      },
    })
  }

  function Callback(data) {

    let table = "<table class=\"table\" id=\"datas\" >";
    table += "<tr>";
    table += "<th width=\"20%\">微信名</th>";
    table += "<th width=\"17%\">备注</th>";
    table += "<th width=\"20%\">审核状态</th>";
    table += "<th width=\"20%\">开启状态</th>";
    table += "<th width=\"20%\">操作</th>";
    table += "</tr>";


    if (data.length != 0) {
      let row = $("#template").clone();
      for (let i = 0; i < data.length; i++) {
        table += "<tr>";
        let inpName = "inp" + i;


//        let inp_acNumHtml = '<input type="text" id=' + inpName + ' size="8" value=' + data[i].payee + '>';
        let acNumHtml = '<td><input class="h_name" id=' + inpName + ' type="text" size="8" value=' + data[i].payee + '></td>';
        let acNameHtml = '<td  onmousemove="sendMsg(\''+data[i].acName+ '\')"><span class="h_nameTwo">'+data[i].acName+'</span></td>';


        let checkStatus = "";
        if (data[i].checkStatus == 1) {
          checkStatus += '<td class="h_status"  onmousemove="sendMsg(\'待审核\')">待审核</td>';
        } else if (data[i].checkStatus == 2) {
          checkStatus += '<td class="h_status" onmousemove="sendMsg('+data[i].checkInfo+')">" + data[i].checkInfo + "</td>';
        } else if (data[i].checkStatus == 3) {
//          checkStatus += '<td class="h_status" onmousemove="sendMsg("审核通过")">审核通过</td>';
          checkStatus += '<td class="h_status" onmousemove="sendMsg(\'审核通过\')">审核通过</td>';
        }
        var checkboxHTML = '';
        if (data[i].useStatus == 1) {
           checkboxHTML+= '<td>';
            checkboxHTML += ' <span class="h_opt">';
                  checkboxHTML += '<label class="bui-switch-label bui-switch-anim">';
                  checkboxHTML += '<input type="checkbox" name="s" checked onchange="updateStatus(' + data[i].id + ',2)" /><i class="bui-switch"></i>';
                  checkboxHTML += ' </label>';
            checkboxHTML += '</span>';
//              checkboxHTML += '</label>';
//              checkboxHTML += '  <input type="checkbox" name="s" checked onchange="updateStatus(' + data[i].id + ',2)"/><i class="bui-switch"></i>';
//              checkboxHTML += '</label>';
          checkboxHTML += '</td>';

//          row.find("#daySwitch").html(checkboxHTML);

        } else if (data[i].useStatus == 2) {
            checkboxHTML+= '<td>';
            checkboxHTML += ' <span class="h_opt">';
            checkboxHTML += '<label class="bui-switch-label bui-switch-anim">';
            checkboxHTML += '<input type="checkbox" name="s" onchange="updateStatus(' + data[i].id + ',1)" /><i class="bui-switch"></i>';
            checkboxHTML += ' </label>';
            checkboxHTML += '</span>';
//              checkboxHTML += '</label>';
//              checkboxHTML += '  <input type="checkbox" name="s" checked onchange="updateStatus(' + data[i].id + ',2)"/><i class="bui-switch"></i>';
//              checkboxHTML += '</label>';
            checkboxHTML += '</td>';

        }
        let html = "";
        html += ' <td>';
            html += ' <span class="h_opt">';
                html += ' <i class="glyphicon glyphicon-check" onclick="updateInfn(' + data[i].id + ',' + inpName + ')"></i>';
                html += ' <i class="glyphicon glyphicon-remove" onclick="deleteInfn(' + data[i].id + ')"></i>';
            html += ' </span>';
        html += ' </td>';

//        html += ' <i class="glyphicon glyphicon-remove" onclick="deleteInfn(' + data[i].id + ')"></i>';
        table += "<tr>";
            table +=acNumHtml;
            table += acNameHtml;
            table += checkStatus;
            table += checkboxHTML;
            table += html;
        table += "</tr>";
//                row.find("#operation").html(html);
//                row.appendTo("#datas");
      }
      table += "</table>";
      $("#datas").html(table);
    }

  }

  //操作删除记录
  function deleteInfn(id) {
    if (!confirm("确定要删除吗?")) {
      return;
    }

    if (id == 0 || id == "") {
      showMessage("没有合适数据进行删除！");
      return;
    }

    let timestamp = Date.parse(new Date());
//    let base64 = `{"token": "${storage.getItem("yf_token")}","id":${id},"yn": 1,"agtVer":${publicMap.get("agtVer")},"clientVer":${publicMap.get("clientVer")},"clientType":${publicMap.get("clientType")},"ctime": ${timestamp}}`;
    let base64 = `{"token": "111111","id":${id},"yn": 1,"agtVer":${publicMap.get("agtVer")},"clientVer":${publicMap.get("clientVer")},"clientType":${publicMap.get("clientType")},"ctime": ${timestamp}}`;
    let base = new Base64();
    let result = base.encode(base64);
    let jsonData = JSON.stringify({"jsonData": result});
    $.ajax({
      url: API + '/fine/collAc/updateUse',
      type: 'post',
      dataType: 'json',
      contentType: "application/json",
      data: jsonData,
      // 成功执行
      success(data) {
        let code = data.resultCode;
        if (code !== "0") {
          showMessage(data.message);
        } else {
          loadList();
        }
      },
    })
  }

  //操作保存按钮
  var updateInfn = function (id, wecharName) {
    if (wecharName.defaultValue == wecharName.value) {
      showMessage("该微信名没有进行修改，不能进行保存");
      return;
    }
    let timestamp = Date.parse(new Date());
//    let base64 = `{"token": "${storage.getItem("yf_token")}","id": ${id},"payee":"${wecharName.value}","agtVer":${publicMap.get("agtVer")},"clientVer":${publicMap.get("clientVer")},"clientType":${publicMap.get("clientType")},"ctime": ${timestamp}}`;
    let base64 = `{"token": "111111","id": ${id},"payee":"${wecharName.value}","agtVer":${publicMap.get("agtVer")},"clientVer":${publicMap.get("clientVer")},"clientType":${publicMap.get("clientType")},"ctime": ${timestamp}}`;
    console.log("参数：" + base64);
    let base = new Base64();
    let result = base.encode(base64);
    let jsonData = JSON.stringify({"jsonData": result});
    $.ajax({
      url: API + '/fine/collAc/update',
      type: 'post',
      dataType: 'json',
      contentType: "application/json",
      data: jsonData,
      // 成功执行
      success(data) {
        let code = data.resultCode;
        if (code !== "0") {
          showMessage(data.message);
        } else {
            debugger;
          showMessage('保存成功!');
          let base64 = data.data.jsonData;
          let base = new Base64();
          let rsData = base.decode(base64);
          let rsDataJson = JSON.parse(rsData);
          loadList(rsDataJson.dataList);

        }
      },
    })
  }


  function updateStatus(id, type) {
    if (!confirm("确定要修改吗?")) {
      return;
    }
    let timestamp = Date.parse(new Date());
    let base64 = `{"token": "${storage.getItem("yf_token")}","id":${id},"useStatus": ${type},"agtVer":${publicMap.get("agtVer")},"clientVer":${publicMap.get("clientVer")},"clientType":${publicMap.get("clientType")},"ctime": ${timestamp}}`;
    let base = new Base64();
    let result = base.encode(base64);
    console.log(base64);
    let jsonData = JSON.stringify({"jsonData": result});
    $.ajax({
      url: API + '/fine/collAc/updateUse',
      type: 'post',
      dataType: 'json',
      contentType: "application/json",
      data: jsonData,
      // 成功执行
      success(data) {
        let code = data.resultCode;
        if (code !== "0") {
//                    showMessage(data.code);
          showMessage(data.message);
        } else {
          loadList();
        }
      },
    })
  }

  function sendMsg(value) {
//      alert(1)
      showMessage(value);
  }
</script>
</html>
